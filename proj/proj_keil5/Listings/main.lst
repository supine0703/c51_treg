C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\install\Keil_v5\C51\BIN\C51.EXE ..\src\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\include) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /**
   2           * main.c
   3           * ä½œè€…ï¼šæå®—éœ– æ—¥æœŸï¼š2023/12/01
   4           * CSDNæ˜µç§°ï¼šLeisure_æ°´ä¸­é±¼
   5           * CSDN: https://blog.csdn.net/Supine_0?type=blog
   6           * ----------------------------------------------
   7           * ç¨‹åºçš„main ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ† åˆå§‹åŒ–éƒ¨åˆ† ä¸»å¾ªç¯éƒ¨åˆ† ä¸­æ–­éƒ¨åˆ†
   8           */
   9          #include "__config__.h"
  10          #include "at24c02.h"
  11          #include "ds18b20.h"
  12          #include "i2c.h"
  13          #include "lcd1602.h"
  14          #include "ultimate.h"
  15          #include "utility.h"
  16          #include "music.h"
  17          
  18          #define uint unsigned int
  19          #define uchar unsigned char
  20          
  21          extern bit page_change;
  22          extern bit settings_mode;
  23          extern bit ready_settings;
  24          extern bit convert_finished;
  25          extern bit dc_motor_working;
  26          extern bit above_upper_limit;
  27          extern bit below_lower_limit;
  28          extern bit ringtone_change;
  29          extern bit save_in_24c02;
  30          
  31          extern float temperature, highest, lowest;
  32          extern uchar idata settingsSave;
  33          extern uchar page, option;
  34          extern uchar hus, hms, hs, hm, lus, lms, ls, lm;
  35          extern uchar dsr, fanGear, fanGearStep;
  36          extern uchar audio, ringtoneNum;
  37          extern char upperLimit, lowerLimit;
  38          
  39          extern uchar numStr[];
  40          extern uint code cttcn[];
  41          extern uint convertCount, dcmCount;
  42          extern uint SHOW_WAIT;
  43          
  44          sbit RELAY = DEFINE_RELAY; // ç»§ç”µå™¨
  45          sbit DCM = DEFINE_DCM;     // ç›´æµç”µæœº
  46          sbit Buzzer = DEFINE_BUZZRT;
  47          
  48          void init_data(void);          // åˆå§‹åŒ–æ•°æ®
  49          void init_program(void);       // åˆå§‹åŒ–ç¨‹åº
  50          void UpdateTemperature(void);  // æ›´æ–°æ¸©åº¦ä¿¡æ¯
  51          void UpdateViewPageShow(void); // åˆ·æ–°è§†å›¾æ˜¾ç¤º
  52          
  53          void main(void)
  54          {
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 2   

  55   1          // /**
  56   1          //  * åˆå§‹åŒ–æ•°æ®:
  57   1          //  * 1. åˆå§‹åŒ– å®šæ—¶/è®¡æ•°å™¨ å¯¹åº”çš„æ–¹å¼åˆå€¼ ä¼˜å…ˆçº§
  58   1          //  * 2. åˆå§‹åŒ– å¤–éƒ¨ä¸­æ–­ å¯¹åº”çš„æ–¹å¼ åˆå€¼ ä¼˜å…ˆçº§
  59   1          //  * 3. ä» DS18B20 è¯»å– æ¸©åº¦ä¸Šé™ ä¸‹é™ åˆ†è¾¨ç‡
  60   1          //  * 4. ä» 24LC02  è¯»å– ...
  61   1          //  */
  62   1          // init_data();
  63   1      
  64   1          // /**
  65   1          //  * åˆå§‹åŒ–ç¨‹åº:
  66   1          //  * 1. å¼€å§‹æ¸©åº¦è½¬æ¢
  67   1          //  * 2. LCD1602åˆå§‹åŒ– æ˜¾ç¤ºå¼€æœºç•Œé¢
  68   1          //  * 3. ä»¥æ‰“å­—æœºæ•ˆæœæ˜¾ç¤ºä¸»è§†å›¾
  69   1          //  * 4. æ‰“å¼€ å®šæ—¶/è®¡æ•°å™¨ä¸­æ–­ å¤–éƒ¨ä¸­æ–­
  70   1          //  */
  71   1          // init_program();
  72   1      
  73   1          // /**
  74   1          //  * ç¨‹åºçš„ä¸»å¾ªç¯:
  75   1          //  * 1. åˆ¤æ–­æ˜¯å“ªä¸€ç§æ¨¡å¼å¹¶æ‰§è¡Œæ¨¡å¼å¯¹åº”çš„ç¨‹åº
  76   1          //  * 2. æ¨¡å¼ä¸»ç¨‹åº:
  77   1          //  * - è®¾ç½®æ¨¡å¼
  78   1          //  *
  79   1          //  * - è§†å›¾æ¨¡å¼
  80   1          //  *   1. å¦‚æœæ¸©åº¦è½¬æ¢å®Œæˆ æ›´æ–°æ¸©åº¦ä¿¡æ¯
  81   1          //  *   2. åˆ¤æ–­å½“å‰å¤„äºå“ªä¸€ä¸ªè§†å›¾
  82   1          //  *   3. å¦‚æœè§†å›¾å‘ç”Ÿæ”¹å˜ éœ€è¦æ›´æ–°æ•´ä¸ªè§†å›¾
  83   1          //  *   4. å¦‚æœè§†å›¾æ²¡æœ‰æ”¹å˜ åˆ·æ–°å½“å‰è§†å›¾çš„ å¯å˜é‡
  84   1          //  *   5. ä»¥ æŒ‰é”®ç³»ç»Ÿ1 æ¥æ”¶æŒ‰é”®æ“ä½œ å¹¶ååº”
  85   1          //  *
  86   1          //  * å¤–éƒ¨ä¸­æ–­:
  87   1          //  * X0: é•¿æŒ‰åˆ‡æ¢è®¾ç½®æ¨¡å¼å’Œè§†å›¾æ¨¡å¼
  88   1          //  */
  89   1          // while (1)
  90   1          // {
  91   1          //     if (settings_mode) // è®¾ç½®æ¨¡å¼
  92   1          //     {
  93   1          //         if (ready_settings)
  94   1          //         {
  95   1          //             ready_settings = 0;
  96   1          //             ShowSettings(0); // æ˜¾ç¤ºè®¾ç½®æ¨¡å¼ å¹¶æŒ‡å‘ç¬¬ä¸€æ¡
  97   1          //         }
  98   1          //         KeysSystem_2(); // ç¬¬äºŒå¥—æŒ‰é”®äº‹ä»¶å“åº”ç³»ç»Ÿ
  99   1          //     }
 100   1          //     else // è§†å›¾æ¨¡å¼
 101   1          //     {
 102   1          //         if (ringtone_change)
 103   1          //         {
 104   1          //             // ä»ç¬¬äºŒå­—èŠ‚å¼€å§‹è¯»å–é“ƒå£° æ”¾å…¥ ringtone
 105   1          //             // ringtone[127]
 106   1          //             // ...
 107   1          //         }
 108   1          //         if (save_in_24c02)
 109   1          //         {
 110   1          //             save_in_24c02 = 0;
 111   1          //             At24c02_WriteByte(0xa0, 0x00, &settingsSave, 1);
 112   1          //         }
 113   1          //         if (convert_finished)
 114   1          //         { // å¦‚æœæ¸©åº¦è½¬æ¢å®Œæˆ æ›´æ–°æ¸©åº¦ä¿¡æ¯
 115   1          //             UpdateTemperature();
 116   1          //             convert_finished = 0;
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 3   

 117   1          //         }
 118   1          //         UpdateViewPageShow(); // åˆ·æ–°è§†å›¾æ˜¾ç¤º
 119   1          //         KeysSystem_1();       // ç¬¬ä¸€å¥—æŒ‰é”®äº‹ä»¶å“åº”ç³»ç»Ÿ
 120   1          //     }
 121   1          // }
 122   1          unsigned char i;
 123   1          Music_store();
 124   1        MusicSelect = 0;
 125   1          for (i = 0;i < 39; i++)
 126   1          {
 127   2              Music_arry[i] = 0;
 128   2          }
 129   1          At24c02_ReadData(0xa0,0x02,Music_arry,39);
 130   1        Timer0Init();
 131   1        while(1)
 132   1        {
 133   2      
 134   2          if(Music_arry[MusicSelect]!=0xFF) //å¦‚æœä¸æ˜¯åœæ­¢æ ‡å¿—ä½
 135   2          {
 136   3            FreqSelect=Music_arry[MusicSelect]; //é€‰æ‹©éŸ³ç¬¦å¯¹åº”çš„é¢‘ç‡
 137   3            MusicSelect++;
 138   3       
 139   3            Delay(Speed/4*Music_arry[MusicSelect]); //é€‰æ‹©éŸ³ç¬¦å¯¹åº”çš„æ—¶é•¿
 140   3            MusicSelect++;
 141   3       
 142   3            TR0=0;//ä¸åŒéŸ³ç¬¦é—´çŸ­æš‚åœé¡¿ï¼Œåˆ©ç”¨å»¶æ—¶å¼€å…³å®šæ—¶å™¨å®ç°
 143   3            Delay(5); 
 144   3            TR0=1;
 145   3          }
 146   2          else  //å¦‚æœæ˜¯åœæ­¢æ ‡å¿—ä½
 147   2          {
 148   3            TR0=0;  //å…³é—­å®šæ—¶å™¨
 149   3            MusicSelect = 0;
 150   3          }
 151   2        }
 152   1      }
 153          
 154          /**
 155           * T0 ä¸­æ–­å‡½æ•°
 156           * è®¾å®š:
 157           *     å®šæ—¶å™¨ T0 æ–¹å¼2 åˆå€¼ 0 è®¡æ•°256æº¢å‡ºä¸€æ¬¡
 158           *     æ‰€ä»¥ å®šæ—¶å™¨ä¸­æ–­å†… æŒ‡ä»¤å‘¨æœŸæ€»å’Œéœ€è¦å°‘äº 250 ä¸ªæœºå™¨å‘¨æœŸ
 159           *     åœ¨ å®šæ—¶å™¨ä¸­æ–­å‡½æ•°å†… è·å–æ¸©åº¦ç­‰å¤æ‚å‡½æ•° ä¼šä¸¥é‡ç ´å T0 äº§ç”Ÿçš„æ—¶åº
 160           * æ€è·¯:
 161           *     åœ¨ä¸­æ–­å‡½æ•°å†…é€šè¿‡è®¾ç½®æ ‡å¿—ä½ è®©å¤æ‚çš„å‡½æ•°é€»è¾‘åœ¨ä¸»å¾ªç¯ä¸­æ‰§è¡Œ
 162           * ç†å¿µ:
 163           *     åœ¨ 11.0592MHzä¸‹  æ¯ 1/3.6 ms æº¢å‡ºä¸€æ¬¡ å³ä¸­æ–­36æ¬¡ä¸º 10ms
 164           *     æ‰€ä»¥ T0 å¯ä»¥ä½œä¸º 1/3.6 ms çš„æ—¶åºäº§ç”Ÿå™¨
 165           *     é€šè¿‡ è®¡æ•°å˜é‡ count å³å¯å®ç°ä¸åŒå‘¨æœŸçš„å®šæ—¶
 166           */
 167          void int_T0() interrupt 1
 168          {
 169   1          // æ ¹æ®åˆ†è¾¨ç‡è°ƒæ•´æ¸©åº¦è½¬æ¢éœ€è¦çš„æ—¶é—´
 170   1          if (!convert_finished && ++convertCount >= cttcn[dsr])
 171   1          {
 172   2              convertCount = 0;
 173   2              convert_finished = 1;
 174   2          }
 175   1          // å°†ç›´æµç”µæœºçš„æ–¹æ³¢åˆ†æˆ 3æ®µ æ ¹æ®æ¡£ä½å†³å®šæŸä¸€æ®µ ç”µå¹³é«˜ä½
 176   1          if (dc_motor_working)
 177   1              if (++dcmCount >= 1440)       // 0.4s
 178   1                  if (dcmCount >= 2520)     // 0.7s
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 4   

 179   1                      if (dcmCount >= 3600) // 1.0s
 180   1                          dcmCount = 0;
 181   1                      else // 0.7s - 1.0s
 182   1                          DCM = fanGear >= 0x03;
 183   1                  else // 0.4s - 0.7s
 184   1                      DCM = fanGear >= 0x02;
 185   1              else // 0.0s - 0.4s
 186   1                  DCM = fanGear >= 0x01;
 187   1          else
 188   1              DCM = 0;
 189   1          // è¿‡ç•Œå®šæ—¶ éœ€è¦ 32ä¸ªæœºå™¨å‘¨æœŸ
 190   1          if (above_upper_limit)
 191   1              AboveLimitClock();
 192   1          else if (below_lower_limit)
 193   1              BelowLimitClock();
 194   1      }
 195          
 196          /**
 197           * X0 ä¸­æ–­å‡½æ•°
 198           * è®¾å®š:
 199           *     å¤–éƒ¨ä¸­æ–­0 ä¸ºä½ä¼˜å…ˆçº§ å¯ä»¥è¢«å®šæ—¶å™¨ä¸­æ–­ ç»™ä¸­æ–­
 200           *     å¦åˆ™ å¤–éƒ¨ä¸­æ–­ä¼šç ´å T0 äº§ç”Ÿçš„æ—¶åº
 201           *     è®¾ç½®æ¨¡å¼ä¸‹ä¼šå…³é—­å®šæ—¶å™¨ å› ä¸ºæ²¡æœ‰ç»§ç»­å®šæ—¶çš„å¿…è¦
 202           * æ€è·¯:
 203           *     å¤–éƒ¨ä¸­æ–­é€šè¿‡è½¯ä»¶å»¶è¿Ÿ æ¯0.05såˆ¤æ–­ä¸€æ¬¡æ˜¯å¦ä»ç„¶å¤„äº æŒ‰ä¸‹ä¸”ä»…æŒ‰ä¸‹ INT0
 204           çŠ¶æ€
 205           *     å½“æŒ‰ä¸‹æŒç»­æ—¶é—´è¶…è¿‡ç»™å®šé˜ˆå€¼å°†ä¼š åˆ‡æ¢è®¾ç½®/è§†å›¾æ¨¡å¼ å¹¶æ‰§è¡Œå¿…è¦çš„
 206           åˆå§‹åŒ–/æ”¶å°¾
 207           * å·¥ä½œ
 208           */
 209          void int_X0() interrupt 0
 210          {
 211   1          uchar ky; // ä¸´æ—¶ç”¨æ¥æ¥æ”¶æŒ‰é”®æ“ä½œ
 212   1          uchar i = 20;
 213   1          KEYS = 0xff;
 214   1          do
 215   1          {
 216   2              ky = 0x03;
 217   2              ky |= KEYS;
 218   2              if (ky != 0xfb)
 219   2              {
 220   3                  Delay1ms(10);
 221   3                  ky = 0x03;
 222   3                  ky |= KEYS;
 223   3                  if (ky != 0xfb)
 224   3                      return;
 225   3              }
 226   2              Delay1ms(50);
 227   2          } while (--i);
 228   1          if (settings_mode) // é€€å‡ºè®¾ç½®æ¨¡å¼
 229   1          {
 230   2              // å°†è®¾ç½®çš„å†…å®¹å­˜å‚¨è‡³ DS18B20
 231   2              DS18B20_Set(upperLimit, lowerLimit, dsr);
 232   2              DS18B20_Save();
 233   2              // å°†è®¾ç½®çš„å†…å®¹å­˜å‚¨è‡³ 24lc02
 234   2              settingsSave = 0xff;
 235   2              settingsSave &= (fanGearStep << 5) | (ringtoneNum << 3) | (audio);
 236   2              /**
 237   2               * @bug ä¸çŸ¥é“ä¸ºä»€ä¹ˆ åªè¦åœ¨æ­¤æ”¾ä¸‹
 238   2               * AT24C02_WriteData(0xa0,0x00,&settingsSave,1) / Byte(...)
 239   2               * å°±ä¼šåœ¨è§¦å‘å¤–éƒ¨ä¸­æ–­æ—¶å¯¼è‡´æ­»å¾ªç¯/å´©æºƒï¼Œå“ªæ€• if(0)
 240   2               * æ²¡æœ‰è°ƒç”¨æ­¤å‡½æ•° ä»…ä»…æ˜¯å­˜åœ¨å°±ä¼šå¯¼è‡´å¦‚æ­¤ å› æ­¤ä½œä¸ºå¦¥å
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 5   

 241   2               åªå¥½è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
 242   2               * åœ¨ä¸»å¾ªç¯ä¸­è¿›è¡Œå­˜å‚¨
 243   2               */
 244   2              save_in_24c02 = 1;
 245   2              // ... ...
 246   2              DS18B20_Convert();
 247   2              convertCount = 0;
 248   2              convert_finished = 0; // é‡æ–°æ‰“å¼€æ¸©åº¦è½¬æ¢
 249   2              TR0 = 1;              // é‡å¯å®šæ—¶å™¨å¼€å§‹æµ‹æ¸©
 250   2              option = 0xff;        // è®¾ç½®æ¨¡å¼ ä¸é€‰æ‹©
 251   2              page_change = 1;      // éœ€è¦åˆ·æ–°æ•´ä¸ªè§†å›¾æ˜¾ç¤º
 252   2          }
 253   1          else // è¿›å…¥è®¾ç½®æ¨¡å¼
 254   1          {
 255   2              RELAY = 0; // æ–­å¼€ç»§ç”µå™¨
 256   2              DCM = 0;   // å…³é—­ç›´æµç”µæœº
 257   2              TR0 = 0;   // å…³é—­å®šæ—¶è®¡å™¨T0
 258   2              // å¾—ä»ä¸»å‡½æ•°ä¸­è°ƒç”¨ å¦åˆ™å¯èƒ½ä¼šå‘ç”Ÿå½¢å‚è¢«å‡ºé”™ äº§ç”Ÿä¸å¯é¢„æ–™é—®é¢˜
 259   2              // å¯ä»¥è®¾å®šä¸€ä¸ªæ ‡å¿— è®©ä¸»å‡½æ•°è°ƒç”¨ä¸€æ¬¡ ready_settings
 260   2              ready_settings = 1; // è¿›å…¥è®¾ç½®æ¨¡å¼ åˆ·æ–°è®¾ç½®æ¨¡å¼æ˜¾ç¤º
 261   2          }
 262   1          settings_mode = !settings_mode;
 263   1      }
 264          
 265          
 266          void int_T1() interrupt 3
 267          {
 268   1          // ... audio éŸ³é¢‘å˜é‡
 269   1          if(FreqTable[FreqSelect]) //å¦‚æœæ˜¯ä¼‘æ­¢ç¬¦(0)ï¼Œé‚£ä¹ˆä¸æ’­æ”¾å£°éŸ³ï¼Œåªè¿›è¡Œå»¶æ—¶
 270   1        {
 271   2          //å–å¯¹åº”é¢‘ç‡å€¼çš„é‡è£…è½½å€¼åˆ°å®šæ—¶å™¨(ç¡®è®¤éŸ³é«˜)FreqSelect=Music[MusicSelect]
 272   2          TL0 = FreqTable[FreqSelect]%256;    //è®¾ç½®ä½ä½å®šæ—¶åˆå€¼
 273   2          TH0 = FreqTable[FreqSelect]/256;    //è®¾ç½®é«˜ä½å®šæ—¶åˆå€¼
 274   2          Buzzer=!Buzzer; //ç¿»è½¬èœ‚é¸£å™¨IOå£(æ³¨æ„è¿™é‡Œçš„é‡è£…å€¼æ˜¯å‘¨æœŸçš„ä¸€åŠï¼Œæ•…ä»…è¿›è¡Œä¸€æ¬¡èœ
             -‚é¸£å™¨çš„ç¿»è½¬)
 275   2        }
 276   1      }
 277          
 278          void init_data(void)
 279          {
 280   1          DCM = 0;     // åˆå§‹åŒ–ç”µæœºä¸å·¥ä½œ
 281   1          RELAY = 0;   // åˆå§‹åŒ–ç»§ç”µå™¨æ–­å¼€
 282   1          TMOD = 0x02; // å®šæ—¶å™¨0 æ–¹å¼2
 283   1          TH0 = 0x00;  // è‡ªåŠ¨è£…å¡«
 284   1          TL0 = 0x00;  // è®° 256 æ¬¡
 285   1      
 286   1          IT0 = 1; // ä¸‹é™æ²¿è§¦å‘
 287   1          PX0 = 0; // ä½ä¼˜å…ˆçº§
 288   1          PT0 = 1; // é«˜ä¼˜å…ˆçº§
 289   1      
 290   1          // ä» DS18B20 è¯»å– æ¸©åº¦ä¸Šä¸‹é™ åˆ†è¾¨ç‡
 291   1          // DS18B20_Update();
 292   1          DS18B20_Get(&upperLimit, &lowerLimit, &dsr);
 293   1          // ä» 24c02 è¯»å– é£æ‰‡æ¡£ä½æ­¥é•¿ å¼€æœºéŸ³ä¹åºå· éŸ³é¢‘(åˆ†ä¸º0-7)
 294   1          I2C_Init();
 295   1          At24c02_ReadData(0xa0, 0x00, &settingsSave, 1);
 296   1          audio = settingsSave & 0x07;
 297   1          ringtoneNum = (settingsSave >> 3) & 0x03;
 298   1          fanGearStep = (settingsSave >> 5) & 0x03;
 299   1          // ä» 24c02 è¯»å– é“ƒå£° æ”¾å…¥ringtone
 300   1          // ...
 301   1      }
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 6   

 302          
 303          void init_program(void)
 304          {
 305   1          DS18B20_Convert();                // å¼€å§‹æ¸©åº¦è½¬æ¢
 306   1          LCD1602_Action();                 // lcd1602 åˆå§‹åŒ–ï¼ˆå¼€æœºï¼‰
 307   1          UpdateTemperature();              // æ›´æ–°æ¸©åº¦ä¿¡æ¯
 308   1          LCD1602_WriteCmd(Show_CursorOn);  // æ‰“å¼€å…‰æ ‡
 309   1          SHOW_WAIT = 40;                   // å¼€æœºæ‰“å­—æœºç‰¹æ•ˆ
 310   1          ShowViewPage_1();                 // æ˜¾ç¤ºé¦–é¡µ
 311   1          LCD1602_WriteCmd(Show_CursorOff); // å…³é—­å…‰æ ‡
 312   1          SHOW_WAIT = 0;
 313   1          DS18B20_Convert();    // å¼€å§‹æ¸©åº¦è½¬æ¢
 314   1          convert_finished = 0; // æ‰“å¼€æ¸©åº¦è½¬æ¢å®šæ—¶
 315   1          EA = 1;               // æ€»ä¸­æ–­å…è®¸å¼€å¯
 316   1          ET0 = 1;              // å…è®¸å®šæ—¶å™¨ä¸­æ–­
 317   1          TR0 = 1;              // T0 å¼€å§‹å·¥ä½œ
 318   1          EX0 = 1;              // å…è®¸å¤–éƒ¨ä¸­æ–­
 319   1      }
 320          
 321          void UpdateTemperature(void)
 322          {
 323   1          uchar i;
 324   1          EA = 0; // è·å–æ¸©åº¦è½¬åŒ–å¾—å…³é—­ä¸­æ–­ å¦åˆ™ä¼šç ´å DS18B20 çš„æ—¶åº é€ æˆé”™è¯¯
 325   1          temperature = DS18B20_ReadTemp(); // è·å–æ¸©åº¦è®¡è½¬æ¢çš„æ¸©åº¦
 326   1          DS18B20_Convert();
 327   1          i = 35;
 328   1          do
 329   1          {
 330   2          } while (--i); // 85ä¸ªæœºå™¨å‘¨æœŸ å…±çº¦ 2+1+5815+70 ä¸ªæœºå™¨å‘¨æœŸ
 331   1          EA = 1; // å‡è®¾è§¦å‘å®šæ—¶ä¸­æ–­ 23 æ¬¡ å¯èƒ½æœ‰ä¸€äº›è¯¯å·® ä½†éå¸¸å°
 332   1          temperature *= 0.0625; // è½¬åŒ–ä¸ºå¯è¯»æ¸©åº¦
 333   1          // æ›´æ–°æ¸©åº¦æœ€å¤§æœ€å°å€¼
 334   1          if (temperature > highest)
 335   1              highest = temperature;
 336   1          if (temperature < lowest)
 337   1              lowest = temperature;
 338   1          // æ¯”è¾ƒæ¸©åº¦æ˜¯å¦è¶Šç•Œ å¹¶é‡‡å–æªæ–½
 339   1          if (temperature > upperLimit) // é«˜äºæ¸©åº¦ä¸Šé™
 340   1          {
 341   2              above_upper_limit = 1; // è®¾ç½®ä¸Šè¶Šç•Œæ ‡å¿—ä½
 342   2              dc_motor_working = 1;  // ç›´æµç”µæœºå¼€å§‹å·¥ä½œ
 343   2              fanGear = (temperature - upperLimit) / fanGearStep + 1;
 344   2              if (fanGear > 3)
 345   2                  fanGear = 3;
 346   2              i = 23;
 347   2              do
 348   2              {
 349   3                  AboveLimitClock(); // ä¸Šè¶Šç•Œå®šæ—¶
 350   3              } while (--i);
 351   2          }
 352   1          else // æ¸©åº¦æ­£å¸¸
 353   1          {
 354   2              above_upper_limit = 0; // ä¸Šè¶Šç•Œæ ‡å¿—ä½æ¸…0
 355   2              dc_motor_working = 0;  // ç›´æµç”µæœºåœæ­¢å·¥ä½œ
 356   2              fanGear = 0;           // ç›´æµç”µæœºæ¡£ä½ç½®0
 357   2          }
 358   1          if (temperature < lowerLimit) // ä½äºæ¸©åº¦ä¸‹é™
 359   1          {
 360   2              below_lower_limit = 1; // è®¾ç½®ä¸‹è¶Šç•Œæ ‡å¿—ä½
 361   2              RELAY = 1;             // é—­åˆç»§ç”µå™¨
 362   2              i = 21;
 363   2              do
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 7   

 364   2              {
 365   3                  BelowLimitClock(); // ä¸‹è¶Šç•Œå®šæ—¶
 366   3              } while (--i);
 367   2          }
 368   1          else // æ¸©åº¦æ­£å¸¸
 369   1          {
 370   2              RELAY = 0;             // æ–­å¼€ç»§ç”µå™¨
 371   2              below_lower_limit = 0; // ä¸‹è¶Šç•Œæ ‡å¿—ä½æ¸…0
 372   2          }
 373   1      }
 374          
 375          void UpdateViewPageShow(void)
 376          {
 377   1          switch (page) // åˆ¤æ–­å½“å‰å¤„äºå“ªä¸€ä¸ªè§†å›¾
 378   1          {
 379   2          case 0x7f: // ä¸»è§†å›¾ (æ¸©åº¦ä¿¡æ¯æŸ¥è¯¢è§†å›¾)
 380   2              if (page_change)
 381   2              { // å¦‚æœè§†å›¾æ”¹å˜ åˆ·æ–°æ•´ä¸ªå±å¹•å†…å®¹æ˜¾ç¤º
 382   3                  ShowViewPage_1();
 383   3                  page_change = 0;
 384   3              }
 385   2              // åˆ·æ–°æ¸©åº¦å€¼æ˜¾ç¤º
 386   2              LCD1602_WriteCmd(Move_Cursor_Row2_Col(2));
 387   2              FloatToString(temperature, numStr, 5, 1);
 388   2              LCD1602_ShowString(numStr);
 389   2              // åˆ·æ–°é£æ‰‡æ¡£ä½æ˜¾ç¤º
 390   2              LCD1602_WriteCmd(Move_Cursor_Row2_Col(15));
 391   2              Int8ToString(fanGear, numStr, 1);
 392   2              LCD1602_ShowString(numStr);
 393   2              break;
 394   2          case 0xbf: // æœ€é«˜/æœ€ä½æ¸©(æ¸©åº¦æå€¼)æŸ¥è¯¢è§†å›¾
 395   2              if (page_change)
 396   2              { // å¦‚æœè§†å›¾æ”¹å˜ åˆ·æ–°æ•´ä¸ªå±å¹•å†…å®¹æ˜¾ç¤º
 397   3                  ShowViewPage_2();
 398   3                  page_change = 0;
 399   3              }
 400   2              // åˆ·æ–°æ˜¾ç¤ºæ¸©åº¦çš„æå€¼
 401   2              LCD1602_WriteCmd(Move_Cursor_Row1_Col(9));
 402   2              UpdateExtremes(1);
 403   2              LCD1602_WriteCmd(Move_Cursor_Row2_Col(9));
 404   2              UpdateExtremes(0);
 405   2              break;
 406   2          case 0xdf: // æ¸©åº¦è¶Šç•Œè®¡æ—¶è§†å›¾
 407   2              if (page_change)
 408   2              { // å¦‚æœè§†å›¾æ”¹å˜ åˆ·æ–°æ•´ä¸ªå±å¹•å†…å®¹æ˜¾ç¤º
 409   3                  ShowViewPage_3();
 410   3                  page_change = 0;
 411   3              }
 412   2              // å¦‚æœæ¸©åº¦é«˜äºä¸Šé™ åˆ·æ–°æ˜¾ç¤ºä¸Šè¶Šç•Œè®¡æ—¶
 413   2              if (above_upper_limit)
 414   2              {
 415   3                  LCD1602_WriteCmd(Move_Cursor_Row1_Col(8));
 416   3                  UpdateOverLimitTimer(1);
 417   3              }
 418   2              // å¦‚æœæ¸©åº¦ä½äºä¸‹é™ åˆ·æ–°æ˜¾ç¤ºä¸‹è¶Šç•Œè®¡æ—¶
 419   2              else if (below_lower_limit)
 420   2              {
 421   3                  LCD1602_WriteCmd(Move_Cursor_Row2_Col(8));
 422   3                  UpdateOverLimitTimer(0);
 423   3              }
 424   2      
 425   2          case 0xef: // è®¾ç½®æŸ¥è¯¢è§†å›¾
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 8   

 426   2              if (page_change)
 427   2              { // å¦‚æœè§†å›¾æ”¹å˜ åˆ·æ–°æ•´ä¸ªå±å¹•å†…å®¹æ˜¾ç¤º
 428   3                  ShowViewPage_4();
 429   3                  page_change = 0;
 430   3              }
 431   2              // æ²¡æœ‰éœ€è¦åˆ·æ–°çš„å¯å˜é‡
 432   2              break;
 433   2          }
 434   1      }
 435          
 436          /*
 437           * ä¸ºäº†æµ‹æ—¶I2C 24C02
 438          extern void _nop_(void);
 439          uchar code aa[] = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
 440          uchar idata bb[] = "                                                        ";
 441          extern void Delay1ms(uint t);
 442          extern uint SHOW_WAIT;
 443          
 444          void main(void)
 445          {
 446              uchar i, j;
 447              LCD1602_WriteCmd(Set_8bit_2line_5x7); // å‘½ä»¤6
 448              LCD1602_WriteCmd(Show_CursorOn);      // å‘½ä»¤4
 449              LCD1602_WriteCmd(Mode_CursorRightMove);
 450              LCD1602_WriteCmd(Clear_Screen); // å‘½ä»¤1
 451              // I2C_WriteData(0xa0, 0x00, aa, 26);
 452              I2C_Init();
 453              // I2C_WriteData(0xa0, 0x80, aa, 53);
 454              // At24c02_WriteByte(0xa0, 0x00, aa, 8);
 455              At24c02_WriteData(0xa0, 0xb0, aa, 53);
 456              SHOW_WAIT = 100;
 457          
 458              // LCD1602_ShowString(aa);
 459              At24c02_ReadData(0xa0, 0xb0, bb, 53);
 460              i = 53;
 461              while (1)
 462              {
 463                  LCD1602_WriteCmd(Move_Cursor_Row1_Col(0));
 464                  for (j = 16; j && i; --j)
 465                  {
 466                      LCD1602_WriteData(bb[--i]);
 467                      Delay1ms(100);
 468                  }
 469                  if (!i)
 470                      break;
 471              }
 472              // // LCD1602_WriteCmd(Return_Cursor);
 473              // // LCD1602_WriteCmd(Move_Cursor_Row2_Col(15));
 474              // // LCD1602_ShowString(bb);
 475              while (1)
 476                  ;
 477          }
 478          */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1167    ----
   CONSTANT SIZE    =    152    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       2
   IDATA SIZE       =    128    ----
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 16:16:00 PAGE 9   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
