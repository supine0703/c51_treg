C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 21:24:39 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\install\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\include;..\include;D:\
                    -install\Keil_v5\C51\INC;..\src) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "music.h"
   2          #include "at24c02.h"
   3          
   4          extern unsigned int Speed;
   5          extern unsigned int FreqSelect, MusicSelect;
   6          extern unsigned char idata Music_arry[128]; 
   7          extern unsigned int code Music[];
   8          extern unsigned int code FreqTable[];
   9          
  10          void main()
  11          {
  12   1        unsigned char music_num, startAddr, musicLen;
  13   1        Music_score();
  14   1      
  15   1        music_num = 1;
  16   1        At24c02_ReadData(0xa0, music_num + 0x03, &startAddr, 1);
  17   1        At24c02_ReadData(0xa0, music_num + 0x04, &musicLen, 1);
  18   1        musicLen -= startAddr;
  19   1      
  20   1        MusicSelect = 0;
  21   1          At24c02_ReadData(0xa0, startAddr, Music_arry, musicLen);
  22   1        Timer0Init();
  23   1        while(1)
  24   1        {
  25   2      
  26   2          if(Music_arry[MusicSelect]!=0xff) //如果不是停止标志位
  27   2          {
  28   3            FreqSelect=Music_arry[MusicSelect]; //选择音符对应的频率
  29   3            MusicSelect++;
  30   3       
  31   3            Delay_music(Speed/4*Music_arry[MusicSelect]); //选择音符对应的时长
  32   3            MusicSelect++;
  33   3       
  34   3            TR0=0;//不同音符间短暂停顿，利用延时开关定时器实现
  35   3            Delay_music(24);  
  36   3            TR0=1;
  37   3          }
  38   2          else  //如果是停止标志位
  39   2          {
  40   3            TR0=0;  //关闭定时器
  41   3            MusicSelect = 0;
  42   3          }
  43   2        }
  44   1      }
  45           
  46          void Timer0_Routine() interrupt 1
  47          {
  48   1        if(FreqTable[FreqSelect]) //如果是休止符(0)，那么不播放声音，只进行延时
  49   1        {
  50   2          //取对应频率值的重装载值到定时器(确认音高)FreqSelect=Music[MusicSelect]
  51   2          TL0 = FreqTable[FreqSelect]&0xff;   //设置低位定时初值
  52   2          TH0 = FreqTable[FreqSelect]>>8;   //设置高位定时初值
  53   2          Buzzer=!Buzzer; //翻转蜂鸣器IO口(注意这里的重装值是周期的一半，故仅进行一次
             -鸣器的翻转)
C51 COMPILER V9.60.7.0   MAIN                                                              12/05/2023 21:24:39 PAGE 2   

  54   2        }
  55   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    233    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
